# å¢å¼ºç‰ˆå®æ—¶å›¾è¡¨ç»„ä»¶å®ç°

## æ¦‚è¿°

åŸºäº nezha-dash é¡¹ç›®çš„ç½‘ç»œå›¾è¡¨å®ç°æ–¹å¼ï¼Œé‡æ–°è®¾è®¡äº†ç¬¦åˆå®æ—¶æ•°æ®æµç‰¹æ€§çš„å›¾è¡¨ç»„ä»¶ï¼Œè§£å†³äº†åŸæœ‰å®ç°çš„ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼š

## è§£å†³çš„é—®é¢˜

### 1. æ•°æ®åˆ·æ–°æ–¹å¼ä¼˜åŒ–
**é—®é¢˜**ï¼šåŸå®ç°æ¯15ç§’é‡ç»˜æ•´ä¸ªå›¾è¡¨ï¼Œå¯¼è‡´å›¾è¡¨"è·³è·ƒ"  
**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°æ•°æ®ç´¯ç§¯æœºåˆ¶ï¼Œæ–°æ•°æ®è¿½åŠ åˆ°ç°æœ‰æ•°æ®é›†
- ä½¿ç”¨å†…éƒ¨çŠ¶æ€ç®¡ç†å†å²æ•°æ®
- æ”¯æŒå¹³æ»‘çš„åŠ¨ç”»è¿‡æ¸¡ï¼ˆ300msç¼“åŠ¨ï¼‰

```typescript
// æ•°æ®æ›´æ–°é€»è¾‘ - åªè¿½åŠ æ–°æ•°æ®ï¼Œä¸é‡ç»˜æ•´ä¸ªå›¾è¡¨
React.useEffect(() => {
  setHistoricalData(prevData => {
    const mergedData = [...prevData];
    // åˆå¹¶æ–°æ—§æ•°æ®ï¼Œé¿å…é‡å¤
    // ä¿æŒæœ€æ–°çš„æ•°æ®ç‚¹ï¼Œç§»é™¤è¿‡è€çš„æ•°æ®
    return sortedData.slice(-maxDataPoints);
  });
}, [apiData]);
```

### 2. å›¾è¡¨å¤§å°æ˜¾ç¤ºé—®é¢˜
**é—®é¢˜**ï¼šå›¾è¡¨åœ¨ä¸åŒå®¹å™¨ä¸­æ˜¾ç¤ºå¼‚å¸¸  
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ ResponsiveContainer ç¡®ä¿è‡ªé€‚åº”
- æ­£ç¡®è®¾ç½®è¾¹è·å’Œå®¹å™¨å°ºå¯¸
- æ”¯æŒå“åº”å¼é«˜åº¦é…ç½®

### 3. æ¨ªåæ ‡æ˜¾ç¤ºä¼˜åŒ–
**é—®é¢˜**ï¼šæ—¶é—´è½´åˆ»åº¦å’Œæ ‡ç­¾æ˜¾ç¤ºä¸æ­£ç¡®  
**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°æ™ºèƒ½æ—¶é—´åˆ»åº¦ç®—æ³•
- æ ¹æ®æ—¶é—´èŒƒå›´åŠ¨æ€è°ƒæ•´åˆ»åº¦é—´éš”
- è‡ªåŠ¨å¯¹é½åˆ°æ•´ç‚¹/æ•´åˆ†é’Ÿ

```typescript
// ç”ŸæˆXè½´åˆ»åº¦ - å‚è€ƒ nezha-dash å®ç°
const generateXAxisTicks = (data, timeRange) => {
  let tickInterval: number;
  if (duration <= 1 * 60 * 60 * 1000) { // 1å°æ—¶å†…
    tickInterval = 10 * 60 * 1000; // æ¯10åˆ†é’Ÿ
  } else if (duration <= 12 * 60 * 60 * 1000) { // 12å°æ—¶å†…
    tickInterval = 60 * 60 * 1000; // æ¯1å°æ—¶
  } else { // 24å°æ—¶
    tickInterval = 2 * 60 * 60 * 1000; // æ¯2å°æ—¶
  }
};
```

## ç»„ä»¶æ¶æ„

### 1. RealtimeLineChart (åŸºç¡€å›¾è¡¨ç»„ä»¶)
- åŸºäº recharts çš„é€šç”¨å®æ—¶å›¾è¡¨ç»„ä»¶
- æ”¯æŒå•è½´å’ŒåŒè½´æ¨¡å¼
- å®ç°æ•°æ®ç‚¹æ•°é‡é™åˆ¶å’Œæ€§èƒ½ä¼˜åŒ–
- å®Œæ•´çš„ä¸»é¢˜é€‚é…æ”¯æŒ

### 2. EnhancedMetricsChart (ä¸šåŠ¡å›¾è¡¨ç»„ä»¶)  
- ä¸“é—¨é€‚é…åç«¯ API æ•°æ®ç»“æ„
- å®ç°æ•°æ®ç´¯ç§¯å’Œå»é‡é€»è¾‘
- æ”¯æŒä¸¤ç§å›¾è¡¨ç±»å‹ï¼šæµé‡è¶‹åŠ¿å’Œè¿æ¥è´¨é‡
- å†…ç½®åŠ è½½ã€é”™è¯¯ã€ç©ºçŠ¶æ€å¤„ç†

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ å®æ—¶æ•°æ®æµ
- **æ•°æ®ç´¯ç§¯**ï¼šæ–°æ•°æ®è¿½åŠ åˆ°ç°æœ‰æ—¶é—´åºåˆ—
- **å¹³æ»‘æ›´æ–°**ï¼šé¿å…å›¾è¡¨é‡ç»˜ï¼Œæ”¯æŒåŠ¨ç”»è¿‡æ¸¡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé™åˆ¶æœ€å¤§æ•°æ®ç‚¹æ•°é‡ï¼ˆé»˜è®¤500ä¸ªï¼‰

### ğŸ“Š æ™ºèƒ½æ—¶é—´è½´
- **åŠ¨æ€åˆ»åº¦**ï¼šæ ¹æ®æ—¶é—´èŒƒå›´æ™ºèƒ½è°ƒæ•´åˆ»åº¦é—´éš”
- **æ—¶é—´å¯¹é½**ï¼šè‡ªåŠ¨å¯¹é½åˆ°æ•´ç‚¹/æ•´åˆ†é’Ÿ
- **æ ¼å¼åŒ–**ï¼š24å°æ—¶å†…æ˜¾ç¤ºæ—¶åˆ†ï¼Œè¶…è¿‡24å°æ—¶æ˜¾ç¤ºæœˆæ—¥æ—¶åˆ†

### ğŸ¨ ä¸»é¢˜é€‚é…
- **æ·±è‰²æ¨¡å¼**ï¼šå®Œæ•´çš„æ·±è‰²ä¸»é¢˜æ”¯æŒ
- **å“åº”å¼**ï¼šè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **è‡ªå®šä¹‰è‰²å½©**ï¼šå‚è€ƒ nezha-dash çš„é…è‰²æ–¹æ¡ˆ

### ğŸ“ˆ åŒè½´å›¾è¡¨
- **è´¨é‡ç›‘æ§**ï¼šå·¦è½´æ˜¾ç¤ºè¿æ¥æ± æ•°é‡ï¼Œå³è½´æ˜¾ç¤ºå»¶è¿Ÿ
- **å•ä½å¤„ç†**ï¼šè‡ªåŠ¨æ ¼å¼åŒ–ä¸åŒå•ä½ï¼ˆB/sã€msã€ä¸ªç­‰ï¼‰
- **æ•°æ®éªŒè¯**ï¼šåªæ˜¾ç¤ºæœ‰æ•ˆæ•°æ®ç³»åˆ—

## ä½¿ç”¨æ–¹å¼

### æµé‡è¶‹åŠ¿å›¾
```tsx
<EnhancedMetricsChart
  apiData={metricsData?.data || null}
  type="traffic"
  height={250}
  timeRange="24h"
  showLegend={true}
  maxDataPoints={500}
/>
```

### è¿æ¥è´¨é‡å›¾ï¼ˆåŒè½´ï¼‰
```tsx
<EnhancedMetricsChart
  apiData={metricsData?.data || null}
  type="quality"
  height={250}
  timeRange="24h"
  showLegend={true}
  maxDataPoints={500}
/>
```

## æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®ç‚¹é™åˆ¶**ï¼šæœ€å¤§ä¿å­˜500ä¸ªæ•°æ®ç‚¹ï¼Œè¶…å‡ºæ—¶ç§»é™¤æœ€æ—§æ•°æ®
2. **å†…å­˜ç®¡ç†**ï¼šä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
3. **åŠ¨ç”»ä¼˜åŒ–**ï¼šä½¿ç”¨ CSS ç¡¬ä»¶åŠ é€Ÿ
4. **æ¡ä»¶æ¸²æŸ“**ï¼šåªæ¸²æŸ“æœ‰æ•°æ®çš„å›¾è¡¨ç³»åˆ—

## å…¼å®¹æ€§

- âœ… ä¸ç°æœ‰ `useMetricsTrend` hook å®Œå…¨å…¼å®¹
- âœ… æ”¯æŒ15ç§’è½®è¯¢æ•°æ®æ›´æ–°
- âœ… é€‚é…ç°æœ‰çš„ API æ•°æ®ç»“æ„
- âœ… ä¿æŒåŸæœ‰çš„æ—¶é—´èŒƒå›´é€‰æ‹©åŠŸèƒ½

## æŠ€æœ¯æ ˆ

- **å›¾è¡¨åº“**ï¼šrecharts ^2.15.3
- **ä¸»é¢˜**ï¼šnext-themes 0.4.6  
- **TypeScript**ï¼šå®Œæ•´ç±»å‹å®šä¹‰
- **React**ï¼šå‡½æ•°ç»„ä»¶ + Hooks

## å‚è€ƒå®ç°

å‚è€ƒäº† [nezha-dash NetworkChart.tsx](https://github.com/hamster1963/nezha-dash/blob/484266666dd61bacb027c887436921dad86ed71e/app/(main)/ClientComponents/detail/NetworkChart.tsx) çš„å®ç°æ–¹å¼ï¼š

- æ•°æ®è½®è¯¢æœºåˆ¶
- æ—¶é—´è½´æ˜¾ç¤ºé€»è¾‘
- çºµåæ ‡æ ¼å¼åŒ–
- å›¾è¡¨ä¸»é¢˜é…ç½®

